import { Component, inject, Input } from '@angular/core';
import { FormsModule } from '@angular/forms';
import { MasterService } from './services/master.service';
import * as i0 from "@angular/core";
import * as i1 from "@angular/forms";
export class DashboardUiComponent {
    constructor() {
        this.masterService = inject(MasterService);
        this.BASE_URL = 'https://dev-api.file-service.mobioffice.io';
        this.menus = [];
        this.styleSketchNumber = null;
        this.selectedProcessName = null;
        this.tableData = [];
        this.selectedTab = 'latest';
        this.latestTableData = [];
        this.historyTableData = [];
    }
    ngOnInit() {
        console.log('we are in dashboard library component');
        this.onInit();
    }
    onInit() {
        this.getAllMaster();
    }
    getAllMaster() {
        // this.masterService.getProcessList().subscribe((res: any) => {
        //   console.log(res);
        //   this.menus = res.data.map((item: any) => {
        //     return { ...item, isSelected: false };
        //   });
        // });
    }
    itemSelected(item) {
        console.log(item);
        this.selectedProcessName = item.processName;
        item.isSelected = true;
        this.menus.map((item) => {
            if (item.processName !== this.selectedProcessName)
                item.isSelected = false;
        });
        console.log(this.styleDetailsForDownload);
        if (this.selectedProcessName) {
            const data = this.styleDetailsForDownload.filePaths[this.selectedProcessName];
            console.log(data);
            this.prepareTableData(data);
        }
    }
    // prepareTableData(data: any) {
    //   this.tableData = Object.entries(data).map(([version, files]: any) => ({
    //     version,
    //     files: Object.entries(files).map(([fileName, details]: any) => ({
    //       fileName,
    //       createdDate: details.createdDate,
    //       url: details.url,
    //     })),
    //   }));
    //   console.log(this.tableData);
    // }
    prepareTableData(data) {
        const allFiles = [];
        // Flatten all versions into single array
        Object.entries(data).forEach(([version, files]) => {
            Object.entries(files).forEach(([fileName, details]) => {
                allFiles.push({
                    version,
                    fileName,
                    createdDate: details.createdDate,
                    url: details.url,
                });
            });
        });
        // Sort by createdDate DESC
        allFiles.sort((a, b) => {
            const d1 = this.parseDate(a.createdDate);
            const d2 = this.parseDate(b.createdDate);
            return d2 - d1;
        });
        if (allFiles.length > 0) {
            // ðŸ”¥ First element only â†’ Latest
            const latestFile = allFiles[0];
            this.latestTableData = [
                {
                    version: latestFile.version,
                    files: [latestFile],
                },
            ];
            // Remaining â†’ History (group back by version)
            const remaining = allFiles.slice(1);
            const groupedHistory = {};
            remaining.forEach((file) => {
                if (!groupedHistory[file.version]) {
                    groupedHistory[file.version] = [];
                }
                groupedHistory[file.version].push(file);
            });
            this.historyTableData = Object.entries(groupedHistory).map(([version, files]) => ({
                version,
                files,
            }));
        }
        console.log('Latest:', this.latestTableData);
        console.log('History:', this.historyTableData);
    }
    parseDate(dateStr) {
        const [datePart, timePart] = dateStr.split(' ');
        const [day, month, year] = datePart.split('-');
        return new Date(`${year}-${month}-${day}T${timePart}`);
    }
    enterPressed() {
        const payload = {
            packetBarCode: this.styleSketchNumber,
            rootFolderName: 'uploads',
            isAllVersionNeeded: 1,
        };
        this.masterService.getDetailsWithProcess(payload, this.BASE_URL).subscribe({
            next: (res) => {
                this.styleDetailsForDownload = res;
                if (res?.filePaths) {
                    const objectKeys = Object.keys(res.filePaths);
                    this.menus = objectKeys.map((item) => ({
                        processName: item,
                        isSelected: false,
                    }));
                }
                else {
                    this.menus = [];
                    this.styleDetailsForDownload = [];
                }
            },
            error: (err) => {
                this.menus = [];
                this.styleDetailsForDownload = [];
                this.tableData = [];
            },
        });
    }
    downloadFile(file) {
        const encodedUrl = encodeURIComponent(file.url);
        const fullUrl = `${this.BASE_URL}/${encodedUrl}`;
        window.open(fullUrl, '_blank');
    }
    static { this.Éµfac = i0.ÉµÉµngDeclareFactory({ minVersion: "12.0.0", version: "17.3.12", ngImport: i0, type: DashboardUiComponent, deps: [], target: i0.ÉµÉµFactoryTarget.Component }); }
    static { this.Éµcmp = i0.ÉµÉµngDeclareComponent({ minVersion: "17.0.0", version: "17.3.12", type: DashboardUiComponent, isStandalone: true, selector: "lib-file-config-library", inputs: { BASE_URL: "BASE_URL" }, providers: [MasterService], ngImport: i0, template: "<div class=\"dashboard-component p-0 m-0\">\r\n  <!-- input filed to search style / sketch number -->\r\n  <div class=\"p-10 col-3 d-flex flex-column\">\r\n    <label class=\"form-group-label text-white-color mb-1\">Enter ID</label>\r\n    <input\r\n      type=\"text\"\r\n      class=\"form-control input-background-color text-white-color\"\r\n      placeholder=\"Enter ID\"\r\n      [(ngModel)]=\"styleSketchNumber\"\r\n      (keydown.enter)=\"enterPressed()\"\r\n    />\r\n  </div>\r\n\r\n  <div class=\"row m-0 p-0 master-container\">\r\n    <div class=\"col-12 m-0 p-0 d-flex\">\r\n      <!-- Sidebar -->\r\n      <div class=\"side__bar d-flex flex-column\">\r\n        @for (item of menus; track item) {\r\n          <div\r\n            class=\"menu-item list-item border-bottom-one\"\r\n            [class.active-menu]=\"item.isSelected\"\r\n            (click)=\"itemSelected(item)\"\r\n          >\r\n            <label class=\"menu-header w-100 cursor-pointer\">\r\n              {{ item.processName }}\r\n            </label>\r\n          </div>\r\n        }\r\n      </div>\r\n\r\n      <!-- Right content -->\r\n      <div class=\"display-container flex-grow-1 ms-3 p-10\">\r\n        <h4 class=\"text-white-color mb-1 border-bottom-one\">File Details:</h4>\r\n\r\n        @if (!!selectedProcessName) {\r\n          <div class=\"tabs\">\r\n            <button\r\n              class=\"tab-btn\"\r\n              [class.active]=\"selectedTab === 'latest'\"\r\n              (click)=\"selectedTab = 'latest'\"\r\n            >\r\n              Latest\r\n            </button>\r\n\r\n            <button\r\n              class=\"tab-btn\"\r\n              [class.active]=\"selectedTab === 'history'\"\r\n              (click)=\"selectedTab = 'history'\"\r\n            >\r\n              History\r\n            </button>\r\n          </div>\r\n        }\r\n\r\n        <!-- Table -->\r\n\r\n        @if (latestTableData.length || historyTableData.length) {\r\n          <table class=\"custom-table w-100 mt-2\">\r\n            <thead>\r\n              <tr>\r\n                <th class=\"text-white-color\">Version</th>\r\n                <th class=\"text-white-color\">File Name</th>\r\n                <th class=\"text-white-color\">Created Date</th>\r\n              </tr>\r\n            </thead>\r\n\r\n            <tbody>\r\n              @for (\r\n                group of selectedTab === \"latest\"\r\n                  ? latestTableData\r\n                  : historyTableData;\r\n                track group.version\r\n              ) {\r\n                @for (\r\n                  file of group.files;\r\n                  track file.fileName;\r\n                  let i = $index\r\n                ) {\r\n                  <tr>\r\n                    <td class=\"text-white-color\">\r\n                      @if (i === 0) {\r\n                        {{ group.version }}\r\n                      }\r\n                    </td>\r\n                    <td>\r\n                      <div class=\"file-cell\">\r\n                        <span class=\"file-name text-white-color\">{{\r\n                          file.fileName\r\n                        }}</span>\r\n\r\n                        <svg\r\n                          class=\"download-icon\"\r\n                          xmlns=\"http://www.w3.org/2000/svg\"\r\n                          viewBox=\"0 0 24 24\"\r\n                          width=\"16\"\r\n                          height=\"16\"\r\n                          (click)=\"downloadFile(file)\"\r\n                          title=\"Download\"\r\n                        >\r\n                          <path\r\n                            fill=\"currentColor\"\r\n                            d=\"M5 20h14v-2H5v2Zm7-18v10.17l3.59-3.58L17 10l-5 5-5-5 1.41-1.41L11 12.17V2h1Z\"\r\n                          />\r\n                        </svg>\r\n                      </div>\r\n                    </td>\r\n                    <td class=\"text-white-color\">\r\n                      {{ file.createdDate }}\r\n                    </td>\r\n                  </tr>\r\n                }\r\n\r\n                <tr class=\"version-separator\">\r\n                  <td colspan=\"3\"></td>\r\n                </tr>\r\n              }\r\n            </tbody>\r\n          </table>\r\n        }\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div>\r\n", styles: ["@charset \"UTF-8\";:host{--background-color: rgb(24, 24, 27);--border-color: #d0d5dd80;--gray-dark-3: #3a3a3a;--input-background-color: rgb(40, 40, 40);--text-dark-color: #000;--text-white-color: #fff;--button-color: #ab7340;display:block}.dashboard-component{height:100vh;background-color:var(--input-background-color)}.dashboard-component .h-100{height:100px}.dashboard-component .text-dark-color{color:var(--text-dark-color)}.dashboard-component .text-white-color{color:var(--text-white-color)}.dashboard-component .h-50{height:50px}.dashboard-component .p-10{padding:10px}.dashboard-component .input-background-color{background-color:var(--background-color)!important}.dashboard-component .input-background-color::placeholder{color:var(--text-white-color);opacity:1}.dashboard-component .form-group-label{margin-bottom:6px!important;font-size:12px!important}.dashboard-component input.form-control{height:36px}.dashboard-component .border-bottom-one{border-bottom:1px solid var(--border-color)}.dashboard-component .cursor-pointer{cursor:pointer}.dashboard-component .master-container .side__bar .menu-header{padding:10px 14px;font-size:14px;font-weight:400}.dashboard-component .master-container .side__bar{width:200px;overflow-y:auto;max-height:calc(100vh - 80px);border-right:1px solid #d0d5dd;background-color:var(--background-color);color:var(--text-white-color);flex-shrink:0}.dashboard-component .master-container .menu-item{position:relative}.dashboard-component .master-container .dropdown-indicator{margin-left:auto}.dashboard-component .master-container .list-item.active-menu{background-color:var(--button-color)}.dashboard-component .master-container .child-menu{display:block}.dashboard-component .master-container .child-menu div,.dashboard-component .master-container .child-menu.pl-3{padding-left:20px}.dashboard-component .master-container .sticky-search{position:sticky;top:0;z-index:10;padding:5px}.dashboard-component .master-container .menu-list{flex:1;overflow-y:auto;padding:10px 0}.dashboard-component .master-container .side__bar{display:flex;flex-direction:column;height:91vh;overflow:hidden}.dashboard-component .display-container{background-color:var(--background-color);overflow-y:auto;max-height:91vh}.dashboard-component .custom-table{border-collapse:collapse}.dashboard-component .custom-table th,.dashboard-component .custom-table td{padding:10px 12px;text-align:left;border:none}.dashboard-component .custom-table tbody tr{border-bottom:none}.dashboard-component .version-separator td{height:10px;border-bottom:2px solid var(--text-white-color);opacity:.5}.dashboard-component .download-icon{font-size:16px;color:var(--button-color);cursor:pointer}.dashboard-component .download-icon:hover{transform:scale(1.1)}.dashboard-component .tabs{display:flex;gap:10px;margin-bottom:12px}.dashboard-component .tab-btn{padding:6px 18px;background-color:var(--input-background-color);cursor:pointer;border-radius:6px;color:var(--text-white-color);transition:all .3s ease}.dashboard-component .tab-btn.active,.dashboard-component .tab-btn:hover{background-color:var(--button-color);color:var(--text-white-color)}\n"], dependencies: [{ kind: "ngmodule", type: FormsModule }, { kind: "directive", type: i1.DefaultValueAccessor, selector: "input:not([type=checkbox])[formControlName],textarea[formControlName],input:not([type=checkbox])[formControl],textarea[formControl],input:not([type=checkbox])[ngModel],textarea[ngModel],[ngDefaultControl]" }, { kind: "directive", type: i1.NgControlStatus, selector: "[formControlName],[ngModel],[formControl]" }, { kind: "directive", type: i1.NgModel, selector: "[ngModel]:not([formControlName]):not([formControl])", inputs: ["name", "disabled", "ngModel", "ngModelOptions"], outputs: ["ngModelChange"], exportAs: ["ngModel"] }] }); }
}
i0.ÉµÉµngDeclareClassMetadata({ minVersion: "12.0.0", version: "17.3.12", ngImport: i0, type: DashboardUiComponent, decorators: [{
            type: Component,
            args: [{ selector: 'lib-file-config-library', standalone: true, imports: [FormsModule], providers: [MasterService], template: "<div class=\"dashboard-component p-0 m-0\">\r\n  <!-- input filed to search style / sketch number -->\r\n  <div class=\"p-10 col-3 d-flex flex-column\">\r\n    <label class=\"form-group-label text-white-color mb-1\">Enter ID</label>\r\n    <input\r\n      type=\"text\"\r\n      class=\"form-control input-background-color text-white-color\"\r\n      placeholder=\"Enter ID\"\r\n      [(ngModel)]=\"styleSketchNumber\"\r\n      (keydown.enter)=\"enterPressed()\"\r\n    />\r\n  </div>\r\n\r\n  <div class=\"row m-0 p-0 master-container\">\r\n    <div class=\"col-12 m-0 p-0 d-flex\">\r\n      <!-- Sidebar -->\r\n      <div class=\"side__bar d-flex flex-column\">\r\n        @for (item of menus; track item) {\r\n          <div\r\n            class=\"menu-item list-item border-bottom-one\"\r\n            [class.active-menu]=\"item.isSelected\"\r\n            (click)=\"itemSelected(item)\"\r\n          >\r\n            <label class=\"menu-header w-100 cursor-pointer\">\r\n              {{ item.processName }}\r\n            </label>\r\n          </div>\r\n        }\r\n      </div>\r\n\r\n      <!-- Right content -->\r\n      <div class=\"display-container flex-grow-1 ms-3 p-10\">\r\n        <h4 class=\"text-white-color mb-1 border-bottom-one\">File Details:</h4>\r\n\r\n        @if (!!selectedProcessName) {\r\n          <div class=\"tabs\">\r\n            <button\r\n              class=\"tab-btn\"\r\n              [class.active]=\"selectedTab === 'latest'\"\r\n              (click)=\"selectedTab = 'latest'\"\r\n            >\r\n              Latest\r\n            </button>\r\n\r\n            <button\r\n              class=\"tab-btn\"\r\n              [class.active]=\"selectedTab === 'history'\"\r\n              (click)=\"selectedTab = 'history'\"\r\n            >\r\n              History\r\n            </button>\r\n          </div>\r\n        }\r\n\r\n        <!-- Table -->\r\n\r\n        @if (latestTableData.length || historyTableData.length) {\r\n          <table class=\"custom-table w-100 mt-2\">\r\n            <thead>\r\n              <tr>\r\n                <th class=\"text-white-color\">Version</th>\r\n                <th class=\"text-white-color\">File Name</th>\r\n                <th class=\"text-white-color\">Created Date</th>\r\n              </tr>\r\n            </thead>\r\n\r\n            <tbody>\r\n              @for (\r\n                group of selectedTab === \"latest\"\r\n                  ? latestTableData\r\n                  : historyTableData;\r\n                track group.version\r\n              ) {\r\n                @for (\r\n                  file of group.files;\r\n                  track file.fileName;\r\n                  let i = $index\r\n                ) {\r\n                  <tr>\r\n                    <td class=\"text-white-color\">\r\n                      @if (i === 0) {\r\n                        {{ group.version }}\r\n                      }\r\n                    </td>\r\n                    <td>\r\n                      <div class=\"file-cell\">\r\n                        <span class=\"file-name text-white-color\">{{\r\n                          file.fileName\r\n                        }}</span>\r\n\r\n                        <svg\r\n                          class=\"download-icon\"\r\n                          xmlns=\"http://www.w3.org/2000/svg\"\r\n                          viewBox=\"0 0 24 24\"\r\n                          width=\"16\"\r\n                          height=\"16\"\r\n                          (click)=\"downloadFile(file)\"\r\n                          title=\"Download\"\r\n                        >\r\n                          <path\r\n                            fill=\"currentColor\"\r\n                            d=\"M5 20h14v-2H5v2Zm7-18v10.17l3.59-3.58L17 10l-5 5-5-5 1.41-1.41L11 12.17V2h1Z\"\r\n                          />\r\n                        </svg>\r\n                      </div>\r\n                    </td>\r\n                    <td class=\"text-white-color\">\r\n                      {{ file.createdDate }}\r\n                    </td>\r\n                  </tr>\r\n                }\r\n\r\n                <tr class=\"version-separator\">\r\n                  <td colspan=\"3\"></td>\r\n                </tr>\r\n              }\r\n            </tbody>\r\n          </table>\r\n        }\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div>\r\n", styles: ["@charset \"UTF-8\";:host{--background-color: rgb(24, 24, 27);--border-color: #d0d5dd80;--gray-dark-3: #3a3a3a;--input-background-color: rgb(40, 40, 40);--text-dark-color: #000;--text-white-color: #fff;--button-color: #ab7340;display:block}.dashboard-component{height:100vh;background-color:var(--input-background-color)}.dashboard-component .h-100{height:100px}.dashboard-component .text-dark-color{color:var(--text-dark-color)}.dashboard-component .text-white-color{color:var(--text-white-color)}.dashboard-component .h-50{height:50px}.dashboard-component .p-10{padding:10px}.dashboard-component .input-background-color{background-color:var(--background-color)!important}.dashboard-component .input-background-color::placeholder{color:var(--text-white-color);opacity:1}.dashboard-component .form-group-label{margin-bottom:6px!important;font-size:12px!important}.dashboard-component input.form-control{height:36px}.dashboard-component .border-bottom-one{border-bottom:1px solid var(--border-color)}.dashboard-component .cursor-pointer{cursor:pointer}.dashboard-component .master-container .side__bar .menu-header{padding:10px 14px;font-size:14px;font-weight:400}.dashboard-component .master-container .side__bar{width:200px;overflow-y:auto;max-height:calc(100vh - 80px);border-right:1px solid #d0d5dd;background-color:var(--background-color);color:var(--text-white-color);flex-shrink:0}.dashboard-component .master-container .menu-item{position:relative}.dashboard-component .master-container .dropdown-indicator{margin-left:auto}.dashboard-component .master-container .list-item.active-menu{background-color:var(--button-color)}.dashboard-component .master-container .child-menu{display:block}.dashboard-component .master-container .child-menu div,.dashboard-component .master-container .child-menu.pl-3{padding-left:20px}.dashboard-component .master-container .sticky-search{position:sticky;top:0;z-index:10;padding:5px}.dashboard-component .master-container .menu-list{flex:1;overflow-y:auto;padding:10px 0}.dashboard-component .master-container .side__bar{display:flex;flex-direction:column;height:91vh;overflow:hidden}.dashboard-component .display-container{background-color:var(--background-color);overflow-y:auto;max-height:91vh}.dashboard-component .custom-table{border-collapse:collapse}.dashboard-component .custom-table th,.dashboard-component .custom-table td{padding:10px 12px;text-align:left;border:none}.dashboard-component .custom-table tbody tr{border-bottom:none}.dashboard-component .version-separator td{height:10px;border-bottom:2px solid var(--text-white-color);opacity:.5}.dashboard-component .download-icon{font-size:16px;color:var(--button-color);cursor:pointer}.dashboard-component .download-icon:hover{transform:scale(1.1)}.dashboard-component .tabs{display:flex;gap:10px;margin-bottom:12px}.dashboard-component .tab-btn{padding:6px 18px;background-color:var(--input-background-color);cursor:pointer;border-radius:6px;color:var(--text-white-color);transition:all .3s ease}.dashboard-component .tab-btn.active,.dashboard-component .tab-btn:hover{background-color:var(--button-color);color:var(--text-white-color)}\n"] }]
        }], propDecorators: { BASE_URL: [{
                type: Input
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmlsZS1jb25maWctbGlicmFyeS5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9wcm9qZWN0cy9maWxlLWNvbmZpZy1saWJyYXJ5L3NyYy9saWIvZmlsZS1jb25maWctbGlicmFyeS5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi9wcm9qZWN0cy9maWxlLWNvbmZpZy1saWJyYXJ5L3NyYy9saWIvZmlsZS1jb25maWctbGlicmFyeS5jb21wb25lbnQuaHRtbCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sRUFBRSxLQUFLLEVBQVUsTUFBTSxlQUFlLENBQUM7QUFDakUsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQzdDLE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQzs7O0FBUzFELE1BQU0sT0FBTyxvQkFBb0I7SUFSakM7UUFTVSxrQkFBYSxHQUFHLE1BQU0sQ0FBQyxhQUFhLENBQUMsQ0FBQztRQU9yQyxhQUFRLEdBQVcsNENBQTRDLENBQUM7UUFDekUsVUFBSyxHQUFRLEVBQUUsQ0FBQztRQUNoQixzQkFBaUIsR0FBa0IsSUFBSSxDQUFDO1FBQ3hDLHdCQUFtQixHQUFrQixJQUFJLENBQUM7UUFDMUMsY0FBUyxHQUFVLEVBQUUsQ0FBQztRQUV0QixnQkFBVyxHQUF5QixRQUFRLENBQUM7UUFDN0Msb0JBQWUsR0FBVSxFQUFFLENBQUM7UUFDNUIscUJBQWdCLEdBQVUsRUFBRSxDQUFDO0tBZ0o5QjtJQTdKQyxRQUFRO1FBQ04sT0FBTyxDQUFDLEdBQUcsQ0FBQyx1Q0FBdUMsQ0FBQyxDQUFDO1FBQ3JELElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQztJQUNoQixDQUFDO0lBWUQsTUFBTTtRQUNKLElBQUksQ0FBQyxZQUFZLEVBQUUsQ0FBQztJQUN0QixDQUFDO0lBRU8sWUFBWTtRQUNsQixnRUFBZ0U7UUFDaEUsc0JB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R0FKcEIsQ0FBQyxhQUFhLENBQUMsMEJDUDVCLDR4SUEySEEsOG5HRHJIWSxXQUFXOzs0RkFLVixvQkFBb0I7a0JBUmhDLFNBQVM7K0JBQ0UseUJBQXlCLGNBQ3ZCLElBQUksV0FDUCxDQUFDLFdBQVcsQ0FBQyxhQUNYLENBQUMsYUFBYSxDQUFDOzhCQVlqQixRQUFRO3NCQUFoQixLQUFLIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBpbmplY3QsIElucHV0LCBPbkluaXQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgRm9ybXNNb2R1bGUgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XHJcbmltcG9ydCB7IE1hc3RlclNlcnZpY2UgfSBmcm9tICcuL3NlcnZpY2VzL21hc3Rlci5zZXJ2aWNlJztcclxuQENvbXBvbmVudCh7XHJcbiAgc2VsZWN0b3I6ICdsaWItZmlsZS1jb25maWctbGlicmFyeScsXHJcbiAgc3RhbmRhbG9uZTogdHJ1ZSxcclxuICBpbXBvcnRzOiBbRm9ybXNNb2R1bGVdLFxyXG4gIHByb3ZpZGVyczogW01hc3RlclNlcnZpY2VdLFxyXG4gIHRlbXBsYXRlVXJsOiBgLi9maWxlLWNvbmZpZy1saWJyYXJ5LmNvbXBvbmVudC5odG1sYCxcclxuICBzdHlsZVVybDogYC4vZmlsZS1jb25maWctbGlicmFyeS5jb21wb25lbnQuc2Nzc2AsXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBEYXNoYm9hcmRVaUNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCB7XHJcbiAgcHJpdmF0ZSBtYXN0ZXJTZXJ2aWNlID0gaW5qZWN0KE1hc3RlclNlcnZpY2UpO1xyXG5cclxuICBuZ09uSW5pdCgpIHtcclxuICAgIGNvbnNvbGUubG9nKCd3ZSBhcmUgaW4gZGFzaGJvYXJkIGxpYnJhcnkgY29tcG9uZW50Jyk7XHJcbiAgICB0aGlzLm9uSW5pdCgpO1xyXG4gIH1cclxuXHJcbiAgQElucHV0KCkgQkFTRV9VUkw6IHN0cmluZyA9ICdodHRwczovL2Rldi1hcGkuZmlsZS1zZXJ2aWNlLm1vYmlvZmZpY2UuaW8nO1xyXG4gIG1lbnVzOiBhbnkgPSBbXTtcclxuICBzdHlsZVNrZXRjaE51bWJlcjogc3RyaW5nIHwgbnVsbCA9IG51bGw7XHJcbiAgc2VsZWN0ZWRQcm9jZXNzTmFtZTogc3RyaW5nIHwgbnVsbCA9IG51bGw7XHJcbiAgdGFibGVEYXRhOiBhbnlbXSA9IFtdO1xyXG4gIHN0eWxlRGV0YWlsc0ZvckRvd25sb2FkOiBhbnk7XHJcbiAgc2VsZWN0ZWRUYWI6ICdsYXRlc3QnIHwgJ2hpc3RvcnknID0gJ2xhdGVzdCc7XHJcbiAgbGF0ZXN0VGFibGVEYXRhOiBhbnlbXSA9IFtdO1xyXG4gIGhpc3RvcnlUYWJsZURhdGE6IGFueVtdID0gW107XHJcblxyXG4gIG9uSW5pdCgpIHtcclxuICAgIHRoaXMuZ2V0QWxsTWFzdGVyKCk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGdldEFsbE1hc3RlcigpIHtcclxuICAgIC8vIHRoaXMubWFzdGVyU2VydmljZS5nZXRQcm9jZXNzTGlzdCgpLnN1YnNjcmliZSgocmVzOiBhbnkpID0+IHtcclxuICAgIC8vICAgY29uc29sZS5sb2cocmVzKTtcclxuICAgIC8vICAgdGhpcy5tZW51cyA9IHJlcy5kYXRhLm1hcCgoaXRlbTogYW55KSA9PiB7XHJcbiAgICAvLyAgICAgcmV0dXJuIHsgLi4uaXRlbSwgaXNTZWxlY3RlZDogZmFsc2UgfTtcclxuICAgIC8vICAgfSk7XHJcbiAgICAvLyB9KTtcclxuICB9XHJcblxyXG4gIGl0ZW1TZWxlY3RlZChpdGVtOiBhbnkpIHtcclxuICAgIGNvbnNvbGUubG9nKGl0ZW0pO1xyXG4gICAgdGhpcy5zZWxlY3RlZFByb2Nlc3NOYW1lID0gaXRlbS5wcm9jZXNzTmFtZTtcclxuICAgIGl0ZW0uaXNTZWxlY3RlZCA9IHRydWU7XHJcbiAgICB0aGlzLm1lbnVzLm1hcCgoaXRlbTogYW55KSA9PiB7XHJcbiAgICAgIGlmIChpdGVtLnByb2Nlc3NOYW1lICE9PSB0aGlzLnNlbGVjdGVkUHJvY2Vzc05hbWUpXHJcbiAgICAgICAgaXRlbS5pc1NlbGVjdGVkID0gZmFsc2U7XHJcbiAgICB9KTtcclxuXHJcbiAgICBjb25zb2xlLmxvZyh0aGlzLnN0eWxlRGV0YWlsc0ZvckRvd25sb2FkKTtcclxuICAgIGlmICh0aGlzLnNlbGVjdGVkUHJvY2Vzc05hbWUpIHtcclxuICAgICAgY29uc3QgZGF0YSA9XHJcbiAgICAgICAgdGhpcy5zdHlsZURldGFpbHNGb3JEb3dubG9hZC5maWxlUGF0aHNbdGhpcy5zZWxlY3RlZFByb2Nlc3NOYW1lXTtcclxuICAgICAgY29uc29sZS5sb2coZGF0YSk7XHJcbiAgICAgIHRoaXMucHJlcGFyZVRhYmxlRGF0YShkYXRhKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8vIHByZXBhcmVUYWJsZURhdGEoZGF0YTogYW55KSB7XHJcbiAgLy8gICB0aGlzLnRhYmxlRGF0YSA9IE9iamVjdC5lbnRyaWVzKGRhdGEpLm1hcCgoW3ZlcnNpb24sIGZpbGVzXTogYW55KSA9PiAoe1xyXG4gIC8vICAgICB2ZXJzaW9uLFxyXG4gIC8vICAgICBmaWxlczogT2JqZWN0LmVudHJpZXMoZmlsZXMpLm1hcCgoW2ZpbGVOYW1lLCBkZXRhaWxzXTogYW55KSA9PiAoe1xyXG4gIC8vICAgICAgIGZpbGVOYW1lLFxyXG4gIC8vICAgICAgIGNyZWF0ZWREYXRlOiBkZXRhaWxzLmNyZWF0ZWREYXRlLFxyXG4gIC8vICAgICAgIHVybDogZGV0YWlscy51cmwsXHJcbiAgLy8gICAgIH0pKSxcclxuICAvLyAgIH0pKTtcclxuXHJcbiAgLy8gICBjb25zb2xlLmxvZyh0aGlzLnRhYmxlRGF0YSk7XHJcbiAgLy8gfVxyXG5cclxuICBwcmVwYXJlVGFibGVEYXRhKGRhdGE6IGFueSkge1xyXG4gICAgY29uc3QgYWxsRmlsZXM6IGFueVtdID0gW107XHJcblxyXG4gICAgLy8gRmxhdHRlbiBhbGwgdmVyc2lvbnMgaW50byBzaW5nbGUgYXJyYXlcclxuICAgIE9iamVjdC5lbnRyaWVzKGRhdGEpLmZvckVhY2goKFt2ZXJzaW9uLCBmaWxlc106IGFueSkgPT4ge1xyXG4gICAgICBPYmplY3QuZW50cmllcyhmaWxlcykuZm9yRWFjaCgoW2ZpbGVOYW1lLCBkZXRhaWxzXTogYW55KSA9PiB7XHJcbiAgICAgICAgYWxsRmlsZXMucHVzaCh7XHJcbiAgICAgICAgICB2ZXJzaW9uLFxyXG4gICAgICAgICAgZmlsZU5hbWUsXHJcbiAgICAgICAgICBjcmVhdGVkRGF0ZTogZGV0YWlscy5jcmVhdGVkRGF0ZSxcclxuICAgICAgICAgIHVybDogZGV0YWlscy51cmwsXHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgLy8gU29ydCBieSBjcmVhdGVkRGF0ZSBERVNDXHJcbiAgICBhbGxGaWxlcy5zb3J0KChhLCBiKSA9PiB7XHJcbiAgICAgIGNvbnN0IGQxOiBhbnkgPSB0aGlzLnBhcnNlRGF0ZShhLmNyZWF0ZWREYXRlKTtcclxuICAgICAgY29uc3QgZDI6IGFueSA9IHRoaXMucGFyc2VEYXRlKGIuY3JlYXRlZERhdGUpO1xyXG4gICAgICByZXR1cm4gZDIgLSBkMTtcclxuICAgIH0pO1xyXG5cclxuICAgIGlmIChhbGxGaWxlcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgIC8vIPCflKUgRmlyc3QgZWxlbWVudCBvbmx5IOKGkiBMYXRlc3RcclxuICAgICAgY29uc3QgbGF0ZXN0RmlsZSA9IGFsbEZpbGVzWzBdO1xyXG5cclxuICAgICAgdGhpcy5sYXRlc3RUYWJsZURhdGEgPSBbXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgdmVyc2lvbjogbGF0ZXN0RmlsZS52ZXJzaW9uLFxyXG4gICAgICAgICAgZmlsZXM6IFtsYXRlc3RGaWxlXSxcclxuICAgICAgICB9LFxyXG4gICAgICBdO1xyXG5cclxuICAgICAgLy8gUmVtYWluaW5nIOKGkiBIaXN0b3J5IChncm91cCBiYWNrIGJ5IHZlcnNpb24pXHJcbiAgICAgIGNvbnN0IHJlbWFpbmluZyA9IGFsbEZpbGVzLnNsaWNlKDEpO1xyXG5cclxuICAgICAgY29uc3QgZ3JvdXBlZEhpc3Rvcnk6IGFueSA9IHt9O1xyXG5cclxuICAgICAgcmVtYWluaW5nLmZvckVhY2goKGZpbGUpID0+IHtcclxuICAgICAgICBpZiAoIWdyb3VwZWRIaXN0b3J5W2ZpbGUudmVyc2lvbl0pIHtcclxuICAgICAgICAgIGdyb3VwZWRIaXN0b3J5W2ZpbGUudmVyc2lvbl0gPSBbXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZ3JvdXBlZEhpc3RvcnlbZmlsZS52ZXJzaW9uXS5wdXNoKGZpbGUpO1xyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIHRoaXMuaGlzdG9yeVRhYmxlRGF0YSA9IE9iamVjdC5lbnRyaWVzKGdyb3VwZWRIaXN0b3J5KS5tYXAoXHJcbiAgICAgICAgKFt2ZXJzaW9uLCBmaWxlc10pID0+ICh7XHJcbiAgICAgICAgICB2ZXJzaW9uLFxyXG4gICAgICAgICAgZmlsZXMsXHJcbiAgICAgICAgfSksXHJcbiAgICAgICk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc29sZS5sb2coJ0xhdGVzdDonLCB0aGlzLmxhdGVzdFRhYmxlRGF0YSk7XHJcbiAgICBjb25zb2xlLmxvZygnSGlzdG9yeTonLCB0aGlzLmhpc3RvcnlUYWJsZURhdGEpO1xyXG4gIH1cclxuXHJcbiAgcGFyc2VEYXRlKGRhdGVTdHI6IHN0cmluZyk6IERhdGUge1xyXG4gICAgY29uc3QgW2RhdGVQYXJ0LCB0aW1lUGFydF0gPSBkYXRlU3RyLnNwbGl0KCcgJyk7XHJcbiAgICBjb25zdCBbZGF5LCBtb250aCwgeWVhcl0gPSBkYXRlUGFydC5zcGxpdCgnLScpO1xyXG4gICAgcmV0dXJuIG5ldyBEYXRlKGAke3llYXJ9LSR7bW9udGh9LSR7ZGF5fVQke3RpbWVQYXJ0fWApO1xyXG4gIH1cclxuXHJcbiAgZW50ZXJQcmVzc2VkKCkge1xyXG4gICAgY29uc3QgcGF5bG9hZCA9IHtcclxuICAgICAgcGFja2V0QmFyQ29kZTogdGhpcy5zdHlsZVNrZXRjaE51bWJlcixcclxuICAgICAgcm9vdEZvbGRlck5hbWU6ICd1cGxvYWRzJyxcclxuICAgICAgaXNBbGxWZXJzaW9uTmVlZGVkOiAxLFxyXG4gICAgfTtcclxuXHJcbiAgICB0aGlzLm1hc3RlclNlcnZpY2UuZ2V0RGV0YWlsc1dpdGhQcm9jZXNzKHBheWxvYWQsIHRoaXMuQkFTRV9VUkwpLnN1YnNjcmliZSh7XHJcbiAgICAgIG5leHQ6IChyZXM6IGFueSkgPT4ge1xyXG4gICAgICAgIHRoaXMuc3R5bGVEZXRhaWxzRm9yRG93bmxvYWQgPSByZXM7XHJcblxyXG4gICAgICAgIGlmIChyZXM/LmZpbGVQYXRocykge1xyXG4gICAgICAgICAgY29uc3Qgb2JqZWN0S2V5cyA9IE9iamVjdC5rZXlzKHJlcy5maWxlUGF0aHMpO1xyXG4gICAgICAgICAgdGhpcy5tZW51cyA9IG9iamVjdEtleXMubWFwKChpdGVtKSA9PiAoe1xyXG4gICAgICAgICAgICBwcm9jZXNzTmFtZTogaXRlbSxcclxuICAgICAgICAgICAgaXNTZWxlY3RlZDogZmFsc2UsXHJcbiAgICAgICAgICB9KSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHRoaXMubWVudXMgPSBbXTtcclxuICAgICAgICAgIHRoaXMuc3R5bGVEZXRhaWxzRm9yRG93bmxvYWQgPSBbXTtcclxuICAgICAgICB9XHJcbiAgICAgIH0sXHJcbiAgICAgIGVycm9yOiAoZXJyKSA9PiB7XHJcbiAgICAgICAgdGhpcy5tZW51cyA9IFtdO1xyXG4gICAgICAgIHRoaXMuc3R5bGVEZXRhaWxzRm9yRG93bmxvYWQgPSBbXTtcclxuICAgICAgICB0aGlzLnRhYmxlRGF0YSA9IFtdO1xyXG4gICAgICB9LFxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBkb3dubG9hZEZpbGUoZmlsZTogYW55KSB7XHJcbiAgICBjb25zdCBlbmNvZGVkVXJsID0gZW5jb2RlVVJJQ29tcG9uZW50KGZpbGUudXJsKTtcclxuICAgIGNvbnN0IGZ1bGxVcmwgPSBgJHt0aGlzLkJBU0VfVVJMfS8ke2VuY29kZWRVcmx9YDtcclxuICAgIHdpbmRvdy5vcGVuKGZ1bGxVcmwsICdfYmxhbmsnKTtcclxuICB9XHJcbn1cclxuIiwiPGRpdiBjbGFzcz1cImRhc2hib2FyZC1jb21wb25lbnQgcC0wIG0tMFwiPlxyXG4gIDwhLS0gaW5wdXQgZmlsZWQgdG8gc2VhcmNoIHN0eWxlIC8gc2tldGNoIG51bWJlciAtLT5cclxuICA8ZGl2IGNsYXNzPVwicC0xMCBjb2wtMyBkLWZsZXggZmxleC1jb2x1bW5cIj5cclxuICAgIDxsYWJlbCBjbGFzcz1cImZvcm0tZ3JvdXAtbGFiZWwgdGV4dC13aGl0ZS1jb2xvciBtYi0xXCI+RW50ZXIgSUQ8L2xhYmVsPlxyXG4gICAgPGlucHV0XHJcbiAgICAgIHR5cGU9XCJ0ZXh0XCJcclxuICAgICAgY2xhc3M9XCJmb3JtLWNvbnRyb2wgaW5wdXQtYmFja2dyb3VuZC1jb2xvciB0ZXh0LXdoaXRlLWNvbG9yXCJcclxuICAgICAgcGxhY2Vob2xkZXI9XCJFbnRlciBJRFwiXHJcbiAgICAgIFsobmdNb2RlbCldPVwic3R5bGVTa2V0Y2hOdW1iZXJcIlxyXG4gICAgICAoa2V5ZG93bi5lbnRlcik9XCJlbnRlclByZXNzZWQoKVwiXHJcbiAgICAvPlxyXG4gIDwvZGl2PlxyXG5cclxuICA8ZGl2IGNsYXNzPVwicm93IG0tMCBwLTAgbWFzdGVyLWNvbnRhaW5lclwiPlxyXG4gICAgPGRpdiBjbGFzcz1cImNvbC0xMiBtLTAgcC0wIGQtZmxleFwiPlxyXG4gICAgICA8IS0tIFNpZGViYXIgLS0+XHJcbiAgICAgIDxkaXYgY2xhc3M9XCJzaWRlX19iYXIgZC1mbGV4IGZsZXgtY29sdW1uXCI+XHJcbiAgICAgICAgQGZvciAoaXRlbSBvZiBtZW51czsgdHJhY2sgaXRlbSkge1xyXG4gICAgICAgICAgPGRpdlxyXG4gICAgICAgICAgICBjbGFzcz1cIm1lbnUtaXRlbSBsaXN0LWl0ZW0gYm9yZGVyLWJvdHRvbS1vbmVcIlxyXG4gICAgICAgICAgICBbY2xhc3MuYWN0aXZlLW1lbnVdPVwiaXRlbS5pc1NlbGVjdGVkXCJcclxuICAgICAgICAgICAgKGNsaWNrKT1cIml0ZW1TZWxlY3RlZChpdGVtKVwiXHJcbiAgICAgICAgICA+XHJcbiAgICAgICAgICAgIDxsYWJlbCBjbGFzcz1cIm1lbnUtaGVhZGVyIHctMTAwIGN1cnNvci1wb2ludGVyXCI+XHJcbiAgICAgICAgICAgICAge3sgaXRlbS5wcm9jZXNzTmFtZSB9fVxyXG4gICAgICAgICAgICA8L2xhYmVsPlxyXG4gICAgICAgICAgPC9kaXY+XHJcbiAgICAgICAgfVxyXG4gICAgICA8L2Rpdj5cclxuXHJcbiAgICAgIDwhLS0gUmlnaHQgY29udGVudCAtLT5cclxuICAgICAgPGRpdiBjbGFzcz1cImRpc3BsYXktY29udGFpbmVyIGZsZXgtZ3Jvdy0xIG1zLTMgcC0xMFwiPlxyXG4gICAgICAgIDxoNCBjbGFzcz1cInRleHQtd2hpdGUtY29sb3IgbWItMSBib3JkZXItYm90dG9tLW9uZVwiPkZpbGUgRGV0YWlsczo8L2g0PlxyXG5cclxuICAgICAgICBAaWYgKCEhc2VsZWN0ZWRQcm9jZXNzTmFtZSkge1xyXG4gICAgICAgICAgPGRpdiBjbGFzcz1cInRhYnNcIj5cclxuICAgICAgICAgICAgPGJ1dHRvblxyXG4gICAgICAgICAgICAgIGNsYXNzPVwidGFiLWJ0blwiXHJcbiAgICAgICAgICAgICAgW2NsYXNzLmFjdGl2ZV09XCJzZWxlY3RlZFRhYiA9PT0gJ2xhdGVzdCdcIlxyXG4gICAgICAgICAgICAgIChjbGljayk9XCJzZWxlY3RlZFRhYiA9ICdsYXRlc3QnXCJcclxuICAgICAgICAgICAgPlxyXG4gICAgICAgICAgICAgIExhdGVzdFxyXG4gICAgICAgICAgICA8L2J1dHRvbj5cclxuXHJcbiAgICAgICAgICAgIDxidXR0b25cclxuICAgICAgICAgICAgICBjbGFzcz1cInRhYi1idG5cIlxyXG4gICAgICAgICAgICAgIFtjbGFzcy5hY3RpdmVdPVwic2VsZWN0ZWRUYWIgPT09ICdoaXN0b3J5J1wiXHJcbiAgICAgICAgICAgICAgKGNsaWNrKT1cInNlbGVjdGVkVGFiID0gJ2hpc3RvcnknXCJcclxuICAgICAgICAgICAgPlxyXG4gICAgICAgICAgICAgIEhpc3RvcnlcclxuICAgICAgICAgICAgPC9idXR0b24+XHJcbiAgICAgICAgICA8L2Rpdj5cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIDwhLS0gVGFibGUgLS0+XHJcblxyXG4gICAgICAgIEBpZiAobGF0ZXN0VGFibGVEYXRhLmxlbmd0aCB8fCBoaXN0b3J5VGFibGVEYXRhLmxlbmd0aCkge1xyXG4gICAgICAgICAgPHRhYmxlIGNsYXNzPVwiY3VzdG9tLXRhYmxlIHctMTAwIG10LTJcIj5cclxuICAgICAgICAgICAgPHRoZWFkPlxyXG4gICAgICAgICAgICAgIDx0cj5cclxuICAgICAgICAgICAgICAgIDx0aCBjbGFzcz1cInRleHQtd2hpdGUtY29sb3JcIj5WZXJzaW9uPC90aD5cclxuICAgICAgICAgICAgICAgIDx0aCBjbGFzcz1cInRleHQtd2hpdGUtY29sb3JcIj5GaWxlIE5hbWU8L3RoPlxyXG4gICAgICAgICAgICAgICAgPHRoIGNsYXNzPVwidGV4dC13aGl0ZS1jb2xvclwiPkNyZWF0ZWQgRGF0ZTwvdGg+XHJcbiAgICAgICAgICAgICAgPC90cj5cclxuICAgICAgICAgICAgPC90aGVhZD5cclxuXHJcbiAgICAgICAgICAgIDx0Ym9keT5cclxuICAgICAgICAgICAgICBAZm9yIChcclxuICAgICAgICAgICAgICAgIGdyb3VwIG9mIHNlbGVjdGVkVGFiID09PSBcImxhdGVzdFwiXHJcbiAgICAgICAgICAgICAgICAgID8gbGF0ZXN0VGFibGVEYXRhXHJcbiAgICAgICAgICAgICAgICAgIDogaGlzdG9yeVRhYmxlRGF0YTtcclxuICAgICAgICAgICAgICAgIHRyYWNrIGdyb3VwLnZlcnNpb25cclxuICAgICAgICAgICAgICApIHtcclxuICAgICAgICAgICAgICAgIEBmb3IgKFxyXG4gICAgICAgICAgICAgICAgICBmaWxlIG9mIGdyb3VwLmZpbGVzO1xyXG4gICAgICAgICAgICAgICAgICB0cmFjayBmaWxlLmZpbGVOYW1lO1xyXG4gICAgICAgICAgICAgICAgICBsZXQgaSA9ICRpbmRleFxyXG4gICAgICAgICAgICAgICAgKSB7XHJcbiAgICAgICAgICAgICAgICAgIDx0cj5cclxuICAgICAgICAgICAgICAgICAgICA8dGQgY2xhc3M9XCJ0ZXh0LXdoaXRlLWNvbG9yXCI+XHJcbiAgICAgICAgICAgICAgICAgICAgICBAaWYgKGkgPT09IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAge3sgZ3JvdXAudmVyc2lvbiB9fVxyXG4gICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIDwvdGQ+XHJcbiAgICAgICAgICAgICAgICAgICAgPHRkPlxyXG4gICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cImZpbGUtY2VsbFwiPlxyXG4gICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz1cImZpbGUtbmFtZSB0ZXh0LXdoaXRlLWNvbG9yXCI+e3tcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlLmZpbGVOYW1lXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH19PC9zcGFuPlxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgPHN2Z1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzPVwiZG93bmxvYWQtaWNvblwiXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgeG1sbnM9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Z1wiXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgdmlld0JveD1cIjAgMCAyNCAyNFwiXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg9XCIxNlwiXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0PVwiMTZcIlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIChjbGljayk9XCJkb3dubG9hZEZpbGUoZmlsZSlcIlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlPVwiRG93bmxvYWRcIlxyXG4gICAgICAgICAgICAgICAgICAgICAgICA+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgPHBhdGhcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGw9XCJjdXJyZW50Q29sb3JcIlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZD1cIk01IDIwaDE0di0ySDV2MlptNy0xOHYxMC4xN2wzLjU5LTMuNThMMTcgMTBsLTUgNS01LTUgMS40MS0xLjQxTDExIDEyLjE3VjJoMVpcIlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIC8+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIDwvc3ZnPlxyXG4gICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XHJcbiAgICAgICAgICAgICAgICAgICAgPC90ZD5cclxuICAgICAgICAgICAgICAgICAgICA8dGQgY2xhc3M9XCJ0ZXh0LXdoaXRlLWNvbG9yXCI+XHJcbiAgICAgICAgICAgICAgICAgICAgICB7eyBmaWxlLmNyZWF0ZWREYXRlIH19XHJcbiAgICAgICAgICAgICAgICAgICAgPC90ZD5cclxuICAgICAgICAgICAgICAgICAgPC90cj5cclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICA8dHIgY2xhc3M9XCJ2ZXJzaW9uLXNlcGFyYXRvclwiPlxyXG4gICAgICAgICAgICAgICAgICA8dGQgY29sc3Bhbj1cIjNcIj48L3RkPlxyXG4gICAgICAgICAgICAgICAgPC90cj5cclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIDwvdGJvZHk+XHJcbiAgICAgICAgICA8L3RhYmxlPlxyXG4gICAgICAgIH1cclxuICAgICAgPC9kaXY+XHJcbiAgICA8L2Rpdj5cclxuICA8L2Rpdj5cclxuPC9kaXY+XHJcbiJdfQ==